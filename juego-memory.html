<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juego de Memory Matrix</title>
    <style>
        /* --- Estilos Generales --- */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #1a1a2e;
            color: #eee;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            text-align: center;
        }

        /* --- Contenedor Principal del Juego --- */
        .game-container {
            background-color: #16213e;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            width: 90%;
            max-width: 500px;
        }

        h1 {
            color: #0f3460;
            margin-bottom: 20px;
        }

        /* --- Panel de Información (Nivel, Puntuación, Vidas) --- */
        .info-panel {
            display: flex;
            justify-content: space-around;
            margin-bottom: 25px;
            font-size: 1.2em;
        }

        .info-item span {
            font-weight: bold;
            color: #e94560;
        }

        /* --- Área del Mensaje --- */
        #message {
            height: 30px;
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 20px;
            color: #4fc3f7; /* Color para mensajes neutrales */
            transition: color 0.3s ease;
        }

        #message.success {
            color: #66bb6a; /* Verde para éxito */
        }

        #message.error {
            color: #ef5350; /* Rojo para error */
        }

        /* --- Grid del Juego --- */
        #game-grid {
            display: grid;
            gap: 10px;
            margin: 0 auto 25px auto;
            width: 100%;
            max-width: 400px;
            aspect-ratio: 1 / 1; /* Hace que el grid sea siempre un cuadrado */
        }

        /* --- Celdas del Grid --- */
        .cell {
            background-color: #0f3460;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.2s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2em;
        }

        .cell:hover:not(.active):not(.selected) {
            background-color: #1e5090;
            transform: scale(1.05);
        }

        /* Estados de las celdas */
        .cell.active {
            /* Color cuando se muestra el patrón a memorizar */
            background-color: #4fc3f7;
            animation: pulse 0.5s infinite alternate;
        }

        .cell.selected {
            /* Color cuando el jugador hace clic en una celda */
            background-color: #f8b500;
        }

        .cell.correct-flash {
            /* Parpadeo verde para acierto */
            background-color: #66bb6a !important;
        }

        .cell.incorrect-flash {
            /* Parpadeo rojo para error */
            background-color: #ef5350 !important;
        }

        @keyframes pulse {
            from { opacity: 0.7; }
            to { opacity: 1; }
        }

        /* --- Botón de Inicio --- */
        #start-button {
            background-color: #e94560;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.2em;
            border-radius: 50px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

        #start-button:hover {
            background-color: #c23652;
            transform: scale(1.05);
        }

        #start-button:active {
            transform: scale(0.98);
        }

    </style>
</head>
<body>

    <div class="game-container">
        <h1>Memory Matrix</h1>
        
        <div class="info-panel">
            <div class="info-item">Nivel: <span id="level">1</span></div>
            <div class="info-item">Puntuación: <span id="score">0</span></div>
            <div class="info-item">Vidas: <span id="lives">3</span></div>
        </div>

        <div id="message">¡Presiona Iniciar para Jugar!</div>

        <div id="game-grid"></div>

        <button id="start-button">Iniciar Juego</button>
    </div>

    <script>
        // --- Variables de Estado del Juego ---
        let gridSize = 3; // Tamaño inicial del grid (3x3)
        let level = 1;
        let score = 0;
        let lives = 3;
        let pattern = []; // Almacena los índices de las celdas del patrón
        let playerPattern = []; // Almacena los índices seleccionados por el jugador
        let isShowingPattern = false; // Bandera para evitar clics durante la muestra
        let isPlayerTurn = false; // Bandera para permitir clics en el turno del jugador

        // --- Referencias a Elementos del DOM ---
        const gameGrid = document.getElementById('game-grid');
        const levelDisplay = document.getElementById('level');
        const scoreDisplay = document.getElementById('score');
        const livesDisplay = document.getElementById('lives');
        const messageDisplay = document.getElementById('message');
        const startButton = document.getElementById('start-button');

        // --- Funciones Principales del Juego ---

        /**
         * Inicializa o reinicia el juego a su estado inicial.
         */
        function initGame() {
            gridSize = 3;
            level = 1;
            score = 0;
            lives = 3;
            pattern = [];
            playerPattern = [];
            isShowingPattern = false;
            isPlayerTurn = false;
            updateDisplay();
            messageDisplay.textContent = '¡Presiona Iniciar para Jugar!';
            messageDisplay.className = '';
            gameGrid.innerHTML = '';
            startButton.style.display = 'block';
        }

        /**
         * Comienza una nueva partida.
         */
        function startGame() {
            initGame();
            startButton.style.display = 'none';
            nextLevel();
        }

        /**
         * Prepara y ejecuta el siguiente nivel.
         */
        function nextLevel() {
            levelDisplay.textContent = level;
            playerPattern = [];
            messageDisplay.textContent = `Nivel ${level}: ¡Memoriza!`;
            messageDisplay.className = '';

            // Aumentar la dificultad
            // El tamaño del grid aumenta cada 3 niveles
            if (level > 1 && (level - 1) % 3 === 0) {
                gridSize++;
            }
            
            createGrid(gridSize);
            generatePattern(level + 2); // El patrón tiene 'nivel + 2' celdas
            
            // Pequeño retraso antes de mostrar el patrón
            setTimeout(showPattern, 1000);
        }

        /**
         * Crea el grid visual de celdas.
         * @param {number} size - El tamaño del grid (ej: 3 para 3x3).
         */
        function createGrid(size) {
            gameGrid.innerHTML = ''; // Limpiar grid anterior
            gameGrid.style.gridTemplateColumns = `repeat(${size}, 1fr)`;
            gameGrid.style.gridTemplateRows = `repeat(${size}, 1fr)`;

            for (let i = 0; i < size * size; i++) {
                const cell = document.createElement('div');
                cell.classList.add('cell');
                cell.dataset.index = i; // Guardar el índice de la celda
                cell.addEventListener('click', handleCellClick);
                gameGrid.appendChild(cell);
            }
        }

        /**
         * Genera un patrón aleatorio de celdas a memorizar.
         * @param {number} count - El número de celdas en el patrón.
         */
        function generatePattern(count) {
            pattern = [];
            const totalCells = gridSize * gridSize;
            const indices = Array.from({ length: totalCells }, (_, i) => i);

            // Algoritmo de Fisher-Yates para barajar
            for (let i = indices.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [indices[i], indices[j]] = [indices[j], indices[i]];
            }

            pattern = indices.slice(0, count);
        }

        /**
         * Muestra el patrón al jugador por un tiempo limitado.
         */
        function showPattern() {
            isShowingPattern = true;
            isPlayerTurn = false;

            pattern.forEach(index => {
                const cell = gameGrid.querySelector(`[data-index="${index}"]`);
                cell.classList.add('active');
            });

            // Duración de la muestra del patrón (puede disminuir con el nivel)
            const showTime = Math.max(1500, 2500 - (level * 100));
            
            setTimeout(() => {
                hidePattern();
            }, showTime);
        }

        /**
         * Oculta el patrón y comienza el turno del jugador.
         */
        function hidePattern() {
            document.querySelectorAll('.cell.active').forEach(cell => {
                cell.classList.remove('active');
            });
            
            isShowingPattern = false;
            startPlayerTurn();
        }

        /**
         * Inicia el turno del jugador, permitiéndole hacer clic.
         */
        function startPlayerTurn() {
            isPlayerTurn = true;
            messageDisplay.textContent = '¡Tu turno! Reproduce el patrón.';
        }

        /**
         * Maneja el evento de clic en una celda.
         * @param {Event} event - El evento de clic.
         */
        function handleCellClick(event) {
            if (!isPlayerTurn) return;

            const cell = event.target;
            const index = parseInt(cell.dataset.index);

            // Evitar seleccionar la misma celda dos veces
            if (playerPattern.includes(index)) return;

            cell.classList.add('selected');
            playerPattern.push(index);

            // Comprobar si el jugador ya ha seleccionado todas las celdas
            if (playerPattern.length === pattern.length) {
                isPlayerTurn = false; // Detener más clics
                checkPattern();
            }
        }

        /**
         * Comprueba si el patrón del jugador es correcto.
         */
        function checkPattern() {
            // Ordenamos ambos arrays para que el orden de clic no importe
            const sortedPattern = [...pattern].sort((a, b) => a - b);
            const sortedPlayerPattern = [...playerPattern].sort((a, b) => a - b);
            
            const isCorrect = JSON.stringify(sortedPattern) === JSON.stringify(sortedPlayerPattern);

            if (isCorrect) {
                levelComplete();
            } else {
                levelFailed();
            }
        }

        /**
         * Acciones a realizar cuando el jugador completa un nivel.
         */
        function levelComplete() {
            messageDisplay.textContent = '¡Correcto!';
            messageDisplay.className = 'success';
            score += level * 10;
            updateDisplay();
            
            // Flash verde en las celdas correctas
            pattern.forEach(index => {
                const cell = gameGrid.querySelector(`[data-index="${index}"]`);
                cell.classList.add('correct-flash');
            });

            setTimeout(() => {
                level++;
                nextLevel();
            }, 1500);
        }

        /**
         * Acciones a realizar cuando el jugador falla.
         */
        function levelFailed() {
            lives--;
            updateDisplay();

            messageDisplay.textContent = `¡Incorrecto! Te quedan ${lives} vidas.`;
            messageDisplay.className = 'error';

            // Flash rojo en las celdas incorrectas
            document.querySelectorAll('.cell.selected').forEach(cell => {
                if (!pattern.includes(parseInt(cell.dataset.index))) {
                    cell.classList.add('incorrect-flash');
                }
            });
            
            setTimeout(() => {
                if (lives > 0) {
                    // Dar otra oportunidad: mostrar el patrón de nuevo
                    messageDisplay.textContent = 'Intenta de nuevo...';
                    playerPattern = [];
                    document.querySelectorAll('.cell.selected').forEach(cell => {
                        cell.classList.remove('selected', 'incorrect-flash', 'correct-flash');
                    });
                    setTimeout(showPattern, 1500);
                } else {
                    gameOver();
                }
            }, 2000);
        }

        /**
         * Termina el juego.
         */
        function gameOver() {
            isPlayerTurn = false;
            messageDisplay.textContent = `¡Juego Terminado! Puntuación Final: ${score}`;
            messageDisplay.className = 'error';
            startButton.textContent = 'Jugar de Nuevo';
            startButton.style.display = 'block';
        }

        /**
         * Actualiza los elementos de información en pantalla.
         */
        function updateDisplay() {
            levelDisplay.textContent = level;
            scoreDisplay.textContent = score;
            livesDisplay.textContent = lives;
        }

        // --- Event Listeners ---
        startButton.addEventListener('click', startGame);

        // --- Inicialización ---
        // Mostrar el estado inicial al cargar la página
        initGame();

    </script>
</body>
</html>
