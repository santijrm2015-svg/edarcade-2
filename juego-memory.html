<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memory Matrix - Ed Arcade</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg-color: #0a0a0f; --card-bg: #1a1a2e; --primary-color: #00d4ff; --secondary-color: #ff006e; }
        body { background-color: var(--bg-color); color: #e0e0e0; font-family: 'Roboto', sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; margin: 0; }
        .game-container { text-align: center; width: 100%; max-width: 500px; padding: 1rem; }
        .game-container h1 { font-family: 'Orbitron', sans-serif; font-size: 2.5rem; margin-bottom: 1rem; color: var(--primary-color); text-shadow: 0 0 10px var(--primary-color); }
        .game-info { font-family: 'Orbitron', sans-serif; font-size: 1.2rem; margin-bottom: 1rem; }
        .game-board { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; perspective: 1000px; }
        .card { width: 100%; aspect-ratio: 1 / 1; position: relative; transform-style: preserve-3d; transition: transform 0.5s; cursor: pointer; }
        .card.flipped { transform: rotateY(180deg); }
        .card-front, .card-back { width: 100%; height: 100%; position: absolute; backface-visibility: hidden; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; box-shadow: 0 4px 8px rgba(0,0,0,0.3); }
        .card-front { background: var(--card-bg); border: 2px solid var(--primary-color); }
        .card-back { background: var(--primary-color); color: var(--bg-color); transform: rotateY(180deg); }
        @media (max-width: 480px) {
            .game-board { gap: 8px; }
            .card-front, .card-back { font-size: 2rem; }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>Memory Matrix</h1>
        <div class="game-info">Movimientos: <span id="moves">0</span></div>
        <div class="game-board" id="gameBoard"></div>
    </div>

    <script>
    // ===================================================================
    // INICIO DEL C칍DIGO DEL JUEGO (ENVUELTO EN UN IIFE)
    // ===================================================================
    (function() {
        'use strict';

        // --- VARIABLES DEL JUEGO (AHORA PRIVADAS) ---
        const gameBoard = document.getElementById('gameBoard');
        const movesDisplay = document.getElementById('moves');
        const emojis = ['游', '游', '游꿡', '游끥', '游', '游띶', '游눑', '游댩'];
        let cards = [...emojis, ...emojis];
        let moves = 0;
        let firstCard = null;
        let secondCard = null;
        let lockBoard = false;
        let unflipTimeoutId = null; // Para almacenar el ID del timeout

        // --- FUNCIONES DEL JUEGO ---
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // Funci칩n de evento nombrada para poder ser eliminada
        function flipCard(e) {
            if (lockBoard) return;
            if (this === firstCard) return;

            this.classList.add('flipped');

            if (!firstCard) {
                firstCard = this;
                return;
            }

            secondCard = this;
            moves++;
            movesDisplay.textContent = moves;
            checkForMatch();
        }

        function createCard(emoji) {
            const card = document.createElement('div');
            card.classList.add('card');
            card.innerHTML = `<div class="card-front"></div><div class="card-back">${emoji}</div>`;
            
            // A침adir listeners usando la funci칩n nombrada
            card.addEventListener('click', flipCard);
            card.addEventListener('touchstart', (e) => {
                e.preventDefault();
                flipCard.call(card, e);
            });
            return card;
        }

        function checkForMatch() {
            const isMatch = firstCard.querySelector('.card-back').textContent === secondCard.querySelector('.card-back').textContent;
            isMatch ? disableCards() : unflipCards();
        }

        function disableCards() {
            firstCard.removeEventListener('click', flipCard);
            firstCard.removeEventListener('touchstart', flipCard);
            secondCard.removeEventListener('click', flipCard);
            secondCard.removeEventListener('touchstart', flipCard);
            resetBoard();
        }

        function unflipCards() {
            lockBoard = true;
            // Guardar el ID del timeout para poder limpiarlo
            unflipTimeoutId = setTimeout(() => {
                firstCard.classList.remove('flipped');
                secondCard.classList.remove('flipped');
                resetBoard();
            }, 1000);
        }

        function resetBoard() {
            [firstCard, secondCard] = [null, null];
            lockBoard = false;
        }

        function startGame() {
            shuffle(cards);
            cards.forEach(emoji => gameBoard.appendChild(createCard(emoji)));
        }
        
        // --- FUNCI칍N DE LIMPIEZA PROPIA DEL JUEGO ---
        window.stopGame = function() {
            console.log("Deteniendo Memory Matrix...");
            
            // Limpiar el timeout si est치 activo
            clearTimeout(unflipTimeoutId);
            
            // Eliminar los event listeners de todas las cartas
            const allCards = gameBoard.querySelectorAll('.card');
            allCards.forEach(card => {
                card.removeEventListener('click', flipCard);
                card.removeEventListener('touchstart', flipCard);
            });

            // Limpiar el tablero
            gameBoard.innerHTML = '';
        };

        // --- INICIALIZACI칍N DEL JUEGO ---
        startGame();

    })(); // FIN DEL IIFE
    // ===================================================================

    </script>
</body>
</html>
