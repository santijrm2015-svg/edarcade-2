<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neon Breaker - MiniJuegos</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg-color: #0a0a0f; --primary-color: #00d4ff; --secondary-color: #ff006e; --accent-color: #fb5607; }
        body { background-color: var(--bg-color); color: #e0e0e0; font-family: 'Roboto', sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; margin: 0; }
        .game-container { text-align: center; display: flex; flex-direction: column; align-items: center; width: 100%; max-width: 550px; }
        .game-container h1 { font-family: 'Orbitron', sans-serif; font-size: 2.5rem; margin-bottom: 1rem; color: var(--primary-color); text-shadow: 0 0 10px var(--primary-color); }
        #gameCanvas { border: 2px solid var(--primary-color); border-radius: 10px; box-shadow: 0 0 20px rgba(0, 212, 255, 0.5); background-color: #111; max-width: 100%; height: auto; touch-action: none; }
        .game-controls { margin-top: 1.5rem; }
        .game-controls p { font-family: 'Orbitron', sans-serif; font-size: 1.2rem; }
        @media (max-width: 768px) { .game-controls p { display: none; } }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>Neon Breaker</h1>
        <canvas id="gameCanvas" width="480" height="320"></canvas>
        <div class="game-controls"><p>Mueve el ratón para controlar la pala</p></div>
    </div>

    <script>
    // ===================================================================
    // INICIO DEL CÓDIGO DEL JUEGO (ENVUELTO EN UN IIFE)
    // ===================================================================
    (function() {
        'use strict';

        // --- VARIABLES DEL JUEGO (AHORA PRIVADAS) ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        let ballX = canvas.width / 2;
        let ballY = canvas.height - 30;
        let ballDX = 2;
        let ballDY = -2;
        const ballRadius = 8;

        const paddleHeight = 10;
        const paddleWidth = 75;
        let paddleX = (canvas.width - paddleWidth) / 2;

        const brickRowCount = 5;
        const brickColumnCount = 8;
        const brickWidth = 50;
        const brickHeight = 20;
        const brickPadding = 5;
        const brickOffsetTop = 30;
        const brickOffsetLeft = 20;

        let bricks = [];
        for(let c = 0; c < brickColumnCount; c++) {
            bricks[c] = [];
            for(let r = 0; r < brickRowCount; r++) {
                bricks[c][r] = { x: 0, y: 0, status: 1 };
            }
        }

        let score = 0;
        let lives = 3;
        let gameRunning = true;
        let animationFrameId = null; // Para detener la animación

        // --- FUNCIONES DEL JUEGO ---
        function mouseMoveHandler(e) {
            if (!gameRunning) return;
            const relativeX = e.clientX - canvas.offsetLeft;
            if(relativeX > 0 && relativeX < canvas.width) {
                paddleX = relativeX - paddleWidth / 2;
            }
        }

        function touchMoveHandler(e) {
            if (!gameRunning) return;
            e.preventDefault();
            const relativeX = e.touches[0].clientX - canvas.offsetLeft;
            if(relativeX > 0 && relativeX < canvas.width) {
                paddleX = relativeX - paddleWidth / 2;
            }
        }

        function collisionDetection() {
            for(let c = 0; c < brickColumnCount; c++) {
                for(let r = 0; r < brickRowCount; r++) {
                    const b = bricks[c][r];
                    if(b.status == 1) {
                        if(ballX > b.x && ballX < b.x + brickWidth && ballY > b.y && ballY < b.y + brickHeight) {
                            ballDY = -ballDY;
                            b.status = 0;
                            score++;
                            if(score == brickRowCount * brickColumnCount) {
                                showWinScreen();
                            }
                        }
                    }
                }
            }
        }

        function drawBall() {
            ctx.beginPath();
            ctx.arc(ballX, ballY, ballRadius, 0, Math.PI * 2);
            ctx.fillStyle = "#00d4ff";
            ctx.fill();
            ctx.closePath();
        }

        function drawPaddle() {
            ctx.beginPath();
            ctx.rect(paddleX, canvas.height - paddleHeight, paddleWidth, paddleHeight);
            ctx.fillStyle = "#ff006e";
            ctx.fill();
            ctx.closePath();
        }

        function drawBricks() {
            for(let c = 0; c < brickColumnCount; c++) {
                for(let r = 0; r < brickRowCount; r++) {
                    if(bricks[c][r].status == 1) {
                        const brickX = (c * (brickWidth + brickPadding)) + brickOffsetLeft;
                        const brickY = (r * (brickHeight + brickPadding)) + brickOffsetTop;
                        bricks[c][r].x = brickX;
                        bricks[c][r].y = brickY;
                        ctx.beginPath();
                        ctx.rect(brickX, brickY, brickWidth, brickHeight);
                        // Colores neón para los ladrillos
                        ctx.fillStyle = `hsl(${(r * 60 + c * 20) % 360}, 100%, 50%)`;
                        ctx.fill();
                        ctx.closePath();
                    }
                }
            }
        }

        function drawScore() {
            ctx.font = "16px Orbitron";
            ctx.fillStyle = "#fff";
            ctx.fillText("Puntos: " + score, 8, 20);
        }

        function drawLives() {
            ctx.font = "16px Orbitron";
            ctx.fillStyle = "#fff";
            ctx.fillText("Vidas: " + lives, canvas.width - 65, 20);
        }
        
        function showGameOverScreen() {
            gameRunning = false;
            ctx.fillStyle = 'rgba(0, 0, 0, 0.75)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#ff006e'; // Color de GAME OVER
            ctx.font = '40px Orbitron';
            ctx.textAlign = 'center';
            ctx.fillText('GAME OVER', canvas.width / 2, canvas.height / 2 - 20);
            ctx.fillStyle = '#fff';
            ctx.font = '20px Orbitron';
            ctx.fillText(`Puntuación Final: ${score}`, canvas.width / 2, canvas.height / 2 + 20);
        }

        function showWinScreen() {
            gameRunning = false;
            ctx.fillStyle = 'rgba(0, 0, 0, 0.75)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#00d4ff'; // Color de YOU WIN
            ctx.font = '40px Orbitron';
            ctx.textAlign = 'center';
            ctx.fillText('¡YOU WIN!', canvas.width / 2, canvas.height / 2 - 20);
            ctx.fillStyle = '#fff';
            ctx.font = '20px Orbitron';
            ctx.fillText(`Puntuación Final: ${score}`, canvas.width / 2, canvas.height / 2 + 20);
        }

        function draw() {
            if (!gameRunning) return;

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawBricks();
            drawBall();
            drawPaddle();
            drawScore();
            drawLives();
            collisionDetection();

            // Lógica de rebote de la pelota
            if(ballX + ballDX > canvas.width - ballRadius || ballX + ballDX < ballRadius) {
                ballDX = -ballDX;
            }
            if(ballY + ballDY < ballRadius) {
                ballDY = -ballDY;
            } else if(ballY + ballDY > canvas.height - ballRadius) {
                // Rebote en la pala
                if(ballX > paddleX && ballX < paddleX + paddleWidth) {
                    ballDY = -ballDY;
                } else {
                    // Pierde una vida
                    lives--;
                    if(!lives) {
                        showGameOverScreen();
                    } else {
                        // Resetear posición de la pelota y la pala
                        ballX = canvas.width / 2;
                        ballY = canvas.height - 30;
                        ballDX = 2;
                        ballDY = -2;
                        paddleX = (canvas.width - paddleWidth) / 2;
                    }
                }
            }

            ballX += ballDX;
            ballY += ballDY;
            
            animationFrameId = requestAnimationFrame(draw);
        }

        // --- MANEJO DE EVENTOS (CON LIMPIEZA) ---
        document.addEventListener("mousemove", mouseMoveHandler);
        canvas.addEventListener("touchmove", touchMoveHandler, { passive: false });

        // --- FUNCIÓN DE LIMPIEZA PROPIA DEL JUEGO ---
        window.stopGame = function() {
            console.log("Deteniendo Neon Breaker...");
            gameRunning = false;
            cancelAnimationFrame(animationFrameId);
            document.removeEventListener("mousemove", mouseMoveHandler);
            canvas.removeEventListener("touchmove", touchMoveHandler);
        };

        // --- INICIALIZACIÓN DEL JUEGO ---
        draw();

    })(); // FIN DEL IIFE
    // ===================================================================

    </script>
</body>
</html>
